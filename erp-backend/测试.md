#æµ‹è¯•è®¢å•å’Œè´¢åŠ¡æ¨¡å—å¼€å§‹------------------------------------------------
è¿™é‡Œé›†æˆäº†è‡ªåŠ¨åŒ–æµ‹è¯•
mvn test
#æµ‹è¯•è®¢å•å’Œè´¢åŠ¡æ¨¡å—ç»“æŸ------------------------------------------------

#æµ‹è¯•å•†å“æ¨¡å—å¼€å§‹------------------------------------------------
è¿™é‡Œé›†æˆäº†è‡ªåŠ¨åŒ–æµ‹è¯•
mvn test
#æµ‹è¯•å•†å“æ¨¡å—ç»“æŸ------------------------------------------------


#æµ‹è¯•å•†å“æ¨¡å—å¼€å§‹------------------------------------------------
git bash
# åˆå§‹åŒ–ç®¡ç†å‘˜
curl.exe -X POST http://localhost:8080/init/admin

## æµ‹è¯•æ¸…å•

### 1. è®¤è¯æ¨¡å—æµ‹è¯• âœ…

#### âœ… å·²å®Œæˆï¼šç®¡ç†å‘˜ç™»å½•ã€‚å¦‚æœæ˜¯åº”ä¸ºçš„è¯ï¼Œæœ€å¥½ç”¨æ–‡ä»¶çš„æ–¹å¼è¯·æ±‚ï¼Œæ–‡ä»¶ç¼–ç ä¸ºutf-8,å¦åˆ™ä¼šå‡ºç°ç¼–ç é—®é¢˜
```bash
curl.exe -X POST http://localhost:8080/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

#### ğŸ”² å®¢æˆ·æ³¨å†Œ
åˆ›å»ºæ–‡ä»¶ï¼š register.json
json{
  "username": "customer01",
  "password": "123456",
  "customerName": "TestCompany",
  "phone": "13800138000"
}
æ‰§è¡Œå‘½ä»¤gitbashï¼š
curl.exe -X POST http://localhost:8080/auth/register -H "Content-Type: application/json" --data-binary "@register.json"

**é¢„æœŸç»“æœï¼š**
- è¿”å› `{"code":200,"message":"æ³¨å†ŒæˆåŠŸ"}`
- æ•°æ®åº“ `customer` è¡¨æ–°å¢ä¸€æ¡è®°å½•
- æ•°æ®åº“ `user` è¡¨æ–°å¢ä¸€æ¡è®°å½•ï¼ˆrole=CUSTOMERï¼Œå…³è” customer_idï¼‰




#### ğŸ”² å®¢æˆ·ç™»å½•
```bash
curl.exe -X POST http://localhost:8080/auth/login \
  -H "Content-Type: application/json" \
  --data-binary "@login.json"
```

**é¢„æœŸç»“æœï¼š**
- è¿”å› token å’Œ userInfo
- userInfo ä¸­ `role` ä¸º `CUSTOMER`ï¼Œ`customerId` æœ‰å€¼

---

### 2. JWT æ‹¦æˆªå™¨æµ‹è¯•

#### ğŸ”² æµ‹è¯•æ—  Token è®¿é—®ï¼ˆåº”è¯¥è¢«æ‹¦æˆªï¼‰
```bash
curl.exe -X GET http://localhost:8080/admin/test
```

**é¢„æœŸç»“æœï¼š** è¿”å› 401 æœªæˆæƒ

#### ğŸ”² æµ‹è¯•å¸¦ Token è®¿é—®

-H "Authorization: Bearer $token"

**å…ˆæ·»åŠ ä¸€ä¸ªæµ‹è¯•æ¥å£**ï¼ˆéœ€è¦æ‚¨åˆ›å»ºæ–‡ä»¶ï¼‰ï¼š

**æ–‡ä»¶ï¼š** `src/main/java/com/yourcompany/erp/admin/controller/TestController.java`

```java
package com.yourcompany.erp.admin.controller;

import com.yourcompany.erp.common.response.Result;
import com.yourcompany.erp.common.utils.UserContext;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@Slf4j
@RestController
@RequestMapping("/admin/test")
public class TestController {

    @GetMapping
    public Result<String> test() {
        Long userId = UserContext.getUserId();
        String username = UserContext.getUsername();
        String role = UserContext.getRole();
        
        String info = String.format("å½“å‰ç”¨æˆ·: ID=%d, ç”¨æˆ·å=%s, è§’è‰²=%s", 
                                    userId, username, role);
        log.info(info);
        return Result.success("æµ‹è¯•æˆåŠŸ", info);
    }
}
```

ç„¶åæµ‹è¯•ï¼š
```bash
# å…ˆç™»å½•è·å– token
$token = (curl.exe -X POST http://localhost:8080/auth/login -H "Content-Type: application/json" -d '{"username":"admin","password":"admin123"}' | ConvertFrom-Json).data.token

# å¸¦ Token è®¿é—®
curl.exe -X GET http://localhost:8080/admin/test -H "Authorization: Bearer $token"
```

**é¢„æœŸç»“æœï¼š** è¿”å›å½“å‰ç”¨æˆ·ä¿¡æ¯

---

### 3. æ•°æ®åº“è¿æ¥æµ‹è¯•

#### ğŸ”² æ£€æŸ¥æ•°æ®åº“è¡¨æ˜¯å¦è‡ªåŠ¨åˆ›å»º

è¿æ¥æ•°æ®åº“ï¼š
```bash
docker exec -it erp-postgres psql -U erp -d erp_db
```

æ‰§è¡ŒæŸ¥è¯¢ï¼š
```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨
\dt

-- æŸ¥çœ‹ user è¡¨ç»“æ„
\d "user"

-- æŸ¥çœ‹ customer è¡¨ç»“æ„
\d customer

-- æŸ¥è¯¢æ•°æ®
SELECT * FROM "user";
SELECT * FROM customer;
```

**é¢„æœŸç»“æœï¼š**
- `user` å’Œ `customer` è¡¨å­˜åœ¨
- `user` è¡¨æœ‰ admin è®°å½•
- å¦‚æœæ³¨å†Œè¿‡å®¢æˆ·ï¼Œ`customer` å’Œ `user` è¡¨æœ‰å¯¹åº”è®°å½•

---

### 4. å¼‚å¸¸å¤„ç†æµ‹è¯•

#### ğŸ”² å‚æ•°æ ¡éªŒå¼‚å¸¸
```bash
# ç”¨æˆ·åä¸ºç©º
curl.exe -X POST http://localhost:8080/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"","password":"admin123"}'
```
**é¢„æœŸç»“æœï¼š** è¿”å› `{"code":400,"message":"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"}`

#### ğŸ”² ç”¨æˆ·åå·²å­˜åœ¨
```bash
curl.exe -X POST http://localhost:8080/auth/register \
  -H "Content-Type: application/json" \
  --data-binary "@register.json"
```
**é¢„æœŸç»“æœï¼š** è¿”å› `{"code":500,"message":"ç”¨æˆ·åå·²å­˜åœ¨"}`

#### ğŸ”² å¯†ç é”™è¯¯
```bash
curl.exe -X POST http://localhost:8080/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"wrongpassword"}'
```
**é¢„æœŸç»“æœï¼š** è¿”å› `{"code":500,"message":"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"}`

---

### 5. CORS è·¨åŸŸæµ‹è¯•ï¼ˆå¦‚æœæœ‰å‰ç«¯ï¼‰

å¦‚æœæ‚¨æœ‰å‰ç«¯é¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®å‰ç«¯é¡µé¢ï¼Œè°ƒç”¨åç«¯ APIï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è·¨åŸŸé”™è¯¯ã€‚

---

## æµ‹è¯•å»ºè®®é¡ºåº

1. âœ… ç®¡ç†å‘˜ç™»å½•ï¼ˆå·²å®Œæˆï¼‰
2. ğŸ”² å®¢æˆ·æ³¨å†Œ + ç™»å½•
3. ğŸ”² JWT æ‹¦æˆªå™¨æµ‹è¯•
4. ğŸ”² å¼‚å¸¸å¤„ç†æµ‹è¯•
5. ğŸ”² æ•°æ®åº“æ•°æ®éªŒè¯

æ‚¨å¯ä»¥æŒ‰è¿™ä¸ªé¡ºåºæµ‹è¯•ï¼Œæ¯å®Œæˆä¸€é¡¹å‘Šè¯‰æˆ‘ç»“æœã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæˆ‘ä»¬å†é’ˆå¯¹æ€§è§£å†³ï¼
#æµ‹è¯•å•†å“æ¨¡å—ç»“æŸ------------------------------------------------